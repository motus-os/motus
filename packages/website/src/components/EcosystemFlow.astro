---
const { groups = [], nodes = [], base = '/' } = Astro.props;

const nodesByGroup = groups.reduce((acc, group) => {
  acc[group.id] = nodes.filter((node) => node.group === group.id);
  return acc;
}, {});

const normalizedBase = base.endsWith('/') ? base : `${base}/`;
const withBase = (path) => (path ? `${normalizedBase}${path.replace(/^\/+/, '')}` : null);
---

<div class="grid gap-phi-3 items-start md:grid-cols-[1fr_auto_1fr_auto_1fr]">
  {groups.map((group, index) => (
    <>
      <div class="rounded-2xl border border-line/10 bg-surface p-phi-3 space-y-phi-2">
        <div>
          <p class="text-xs uppercase tracking-[0.3em] text-text-secondary">{group.label}</p>
          <p class="text-sm text-text-secondary mt-phi-1">{group.description}</p>
        </div>
        <div class="space-y-phi-1">
          {(nodesByGroup[group.id] || []).map((node) => (
            <div class="flex items-center gap-phi-2 rounded-xl border border-line/10 bg-surface/80 px-phi-2 py-phi-1 text-sm text-text-secondary">
              {node.logo ? (
                <img src={withBase(node.logo)} alt={node.label} class="h-4 w-4" loading="lazy" />
              ) : (
                <span class="h-2 w-2 rounded-full bg-mint/60"></span>
              )}
              <span class="text-text-primary">{node.label}</span>
            </div>
          ))}
        </div>
      </div>
      {index < groups.length - 1 ? (
        <div class="hidden md:flex items-center justify-center text-mint/70">
          <span class="text-2xl">&#8594;</span>
        </div>
      ) : null}
    </>
  ))}
</div>
