---
import Layout from '../layouts/Layout.astro';
import Section from '../components/Section.astro';
import Panel from '../components/Panel.astro';
import SectionHeader from '../components/SectionHeader.astro';
import PersonaCard from '../components/PersonaCard.astro';

import registry from '../data/module-registry.json';

const kernel = registry.kernel;
const modules = registry.bundled_modules;

const statusClasses = {
  current: 'bg-mint/20 text-mint border border-mint/40',
  building: 'bg-line/10 text-text-secondary border border-line/10',
  future: 'bg-line/5 text-text-secondary border border-line/10',
};

const statusLabel = (status) => status.charAt(0).toUpperCase() + status.slice(1);
---

<Layout title="Implementation">
  <Section tone="light" innerClass="max-w-6xl">
    <section class="space-y-phi-3">
      <SectionHeader
        eyebrow="Implementation Guide"
        title="Kernel + Bundled Modules"
        subtitle="This page documents how to implement Motus correctly. The kernel is the non-negotiable execution layer. Bundled modules add capabilities while preserving kernel invariants."
        as="h1"
        align="left"
        size="xl"
        maxWidth="max-w-3xl"
      />

      <div class="grid md:grid-cols-3 gap-phi-2">
        {Object.entries(registry.status_semantics).map(([key, value]) => (
          <Panel size="sm">
            <div class="text-xs uppercase tracking-[0.2em] text-text-secondary">{key}</div>
            <div class="mt-2 text-sm text-text-primary">{value}</div>
          </Panel>
        ))}
      </div>
    </section>

    <section class="mt-phi-6 space-y-phi-3">
      <SectionHeader
        eyebrow="By role"
        title="Choose Your Path"
        align="left"
        size="md"
      />

      <div class="grid md:grid-cols-2 gap-phi-3">
        <PersonaCard
          title="Builder / Engineer"
          hook="Start with kernel invariants."
          value="Implement one module at a time using the module guides."
          href="#kernel"
          cta="Go to Kernel Guide"
        />
        <PersonaCard
          title="Architect / CTO"
          hook="Audit boundaries and scope."
          value="Review the module registry and audit mapping to validate boundaries."
          href="https://github.com/motus-os/motus/tree/main/packages/cli/docs"
          cta="Open Docs Index"
        />
        <PersonaCard
          title="Compliance / Reviewer"
          hook="Focus on evidence capture."
          value="Policy gates and append-only audit trails define the proof engine."
          href="#proof-engine"
          cta="Go to Proof Engine"
        />
        <PersonaCard
          title="Product / Leadership"
          hook="Track releases with status semantics."
          value="Current, building, and future are defined in the registry."
          href="#module-manager"
          cta="Go to Module Manager"
        />
      </div>
    </section>

    <section class="mt-phi-6 space-y-phi-3">
      <div id="kernel" class="scroll-mt-24"></div>
      <div id="proof-engine" class="scroll-mt-24"></div>
      <div class="flex flex-wrap items-center gap-phi-2">
        <h2 class="text-3xl font-display text-text-primary">{kernel.marketing_name}</h2>
        <span class={`text-xs px-3 py-1 rounded-full ${statusClasses[kernel.status]}`}>
          {statusLabel(kernel.status)}
        </span>
      </div>

      <p class="text-text-secondary max-w-3xl">{kernel.description}</p>

      <div class="grid md:grid-cols-2 gap-phi-3">
        <Panel size="sm">
          <h3 class="text-lg font-display text-text-primary">Primary Surfaces</h3>
          <ul class="mt-phi-2 space-y-phi-1 text-sm text-text-secondary">
            {kernel.primary_surfaces.map((item) => (
              <li>- {item}</li>
            ))}
          </ul>
        </Panel>
        <Panel size="sm">
          <h3 class="text-lg font-display text-text-primary">Best Practices</h3>
          <ul class="mt-phi-2 space-y-phi-1 text-sm text-text-secondary">
            {kernel.best_practices.map((item) => (
              <li>- {item}</li>
            ))}
          </ul>
        </Panel>
      </div>
    </section>

    <section class="mt-phi-6 space-y-phi-3">
      <div id="module-manager" class="scroll-mt-24"></div>
      <SectionHeader
        title="Bundled Modules"
        subtitle="Bundled modules are optional capabilities that must never violate kernel invariants. Each module has a defined scope, best practices, and roadmap."
        align="left"
        size="md"
        maxWidth="max-w-3xl"
      />

      <div class="grid md:grid-cols-2 gap-phi-3">
        {modules.map((module) => (
          <Panel size="sm" class="space-y-phi-2">
            <div class="flex items-center justify-between gap-phi-2">
              <div>
                <h3 class="text-lg font-display text-text-primary">{module.marketing_name}</h3>
                <p class="text-sm text-text-secondary">{module.description}</p>
              </div>
              <span class={`text-xs px-3 py-1 rounded-full ${statusClasses[module.status]}`}>
                {statusLabel(module.status)}
              </span>
            </div>
            <div class="text-xs text-text-secondary uppercase tracking-[0.2em]">Best Practices</div>
            <ul class="space-y-phi-1 text-sm text-text-secondary">
              {module.best_practices.map((item) => (
                <li>- {item}</li>
              ))}
            </ul>
            <div class="flex flex-wrap gap-phi-1 text-xs text-text-secondary">
              <span class="px-2 py-1 rounded-full border border-line/10">{module.scope}</span>
              {module.roadmap_id ? (
                <span class="px-2 py-1 rounded-full border border-line/10">{module.roadmap_id}</span>
              ) : null}
            </div>
          </Panel>
        ))}
      </div>
    </section>

    <section class="mt-phi-6 space-y-phi-2">
      <SectionHeader
        title="Docs Reference"
        subtitle="The canonical docs and registry live in the public repo. These links are the source of truth for implementation details."
        align="left"
        size="md"
        maxWidth="max-w-3xl"
      />
      <div class="flex flex-wrap gap-3 text-sm">
        <a class="text-mint hover:text-text-primary transition-colors" href="https://github.com/motus-os/motus/tree/main/packages/cli/docs">
          Docs Index
        </a>
        <a class="text-mint hover:text-text-primary transition-colors" href="https://github.com/motus-os/motus/blob/main/packages/cli/docs/implementation/kernel.md">
          Kernel Guide
        </a>
        <a class="text-mint hover:text-text-primary transition-colors" href="https://github.com/motus-os/motus/blob/main/packages/cli/docs/standards/module-registry.yaml">
          Module Registry
        </a>
      </div>
    </section>
  </Section>
</Layout>
