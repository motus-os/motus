---
import Layout from '../layouts/Layout.astro';
import Section from '../components/Section.astro';
import Panel from '../components/Panel.astro';
import InstallCommand from '../components/InstallCommand.astro';
import GitHubIcon from '../components/GitHubIcon.astro';
import SectionHeader from '../components/SectionHeader.astro';
import PersonaCard from '../components/PersonaCard.astro';
import ModuleCard from '../components/ModuleCard.astro';
import personaMap from '../data/persona-map.json';
import proofLedger from '../data/proof-ledger.json';

const base = import.meta.env.BASE_URL.endsWith('/')
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;
const proofIndex = new Map(proofLedger.claims.map((claim) => [claim.id, claim]));
const moduleHighlights = [
  {
    name: 'LENS',
    focus: 'Reading',
    summary: {
      lead: 'Precision lensing',
      rest: 'so agents read only what matters.',
    },
    bullets: [
      'Token compression lens',
      'Deterministic context slices',
      'Snapshot provenance',
    ],
    href: `${base}implementation`,
    cta: 'Explore module details',
  },
  {
    name: 'LEASES',
    focus: 'Coordination',
    summary: {
      lead: 'Six-call workflow',
      rest: 'from claim to release, without collisions.',
    },
    bullets: [
      'Lease-based handoffs',
      'Conflict detection',
      'Deterministic releases',
    ],
    href: `${base}implementation`,
    cta: 'Explore module details',
  },
  {
    name: 'RECEIPTS',
    focus: 'Trust',
    summary: {
      lead: 'Receipts for every action',
      rest: 'Cryptographic evidence, not implied trust.',
    },
    bullets: [
      'Evidence bundles',
      'Policy gates',
      'Audit trail integrity',
    ],
    href: `${base}implementation`,
    cta: 'Explore module details',
  },
  {
    name: 'STRATEGIES',
    focus: 'Reasoning',
    summary: {
      lead: 'Reusable strategies',
      rest: 'Patterns instead of ad-hoc reasoning.',
    },
    bullets: [
      'Decision patterns',
      'Trigger conditions',
      'Review heuristics',
    ],
    href: `${base}strategies`,
    cta: 'Explore module details',
  },
];
---

<Layout title="Motus - The Execution Layer for AI Agents">
  <Section tone="dark" pad="hero" class="text-center" innerClass="max-w-4xl">
    <div class="mb-phi-5">
      <span class="text-6xl md:text-[7.5rem] font-display font-semibold text-mint">66%</span>
      <p class="text-lg md:text-xl text-text-secondary mt-phi-2">
        of developers spend more time fixing AI code than they saved.<a href="https://survey.stackoverflow.co/2024/ai" target="_blank" rel="noopener noreferrer" class="text-text-secondary/60 hover:text-mint transition-colors align-super text-sm ml-1" title="Stack Overflow 2024 Developer Survey">*</a>
      </p>
    </div>

    <div class="w-32 h-px bg-mint/70 mx-auto mb-phi-5"></div>

    <p class="text-sm uppercase tracking-[0.35em] text-text-secondary mb-phi-2">The problem is waste</p>
    <h1 class="text-4xl md:text-6xl font-display text-text-primary mb-phi-2">
      Workflow Compression
    </h1>
    <p class="text-lg md:text-2xl text-text-secondary mb-phi-5">
      Agents re-read, re-reason, re-work. Motus eliminates the redundancy.
    </p>

    <div class="flex flex-col md:flex-row gap-phi-3 justify-center items-center">
      <InstallCommand />
      <a href={`${base}how-it-works`} class="text-mint hover:text-text-primary transition-colors px-phi-3 py-phi-2">
        See How It Works &#8594;
      </a>
    </div>
  </Section>

  <Section tone="light" pad="tight" class="border-t border-line/10">
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-phi-2">
      {proofLedger.claims.map((claim) => (
        <Panel size="sm" class="text-center">
          <p class="text-xs uppercase tracking-[0.3em] text-text-secondary">{claim.evidence[0].label}</p>
          <p class="text-text-primary mt-phi-2 text-base md:text-lg leading-relaxed">
            {claim.claim}
          </p>
          <a class="text-sm text-mint hover:text-text-primary transition-colors mt-phi-2 inline-flex" href={claim.evidence[0].url}>
            Evidence &#8594;
          </a>
        </Panel>
      ))}
    </div>
  </Section>

  <Section tone="light">
    <Panel tone="light" size="lg" class="grid md:grid-cols-2 gap-phi-5 items-center">
      <div class="space-y-phi-2">
        <p class="text-sm uppercase tracking-[0.2em] text-text-secondary">For Builders</p>
        <h2 class="text-3xl md:text-4xl font-display text-text-primary">
          Implementation Guide
        </h2>
        <p class="text-lg text-text-secondary">
          Learn how the kernel works and how bundled modules extend it without
          breaking invariants. This is the fastest path from curiosity to
          correct implementation.
        </p>
        <a
          href={`${base}implementation`}
          class="inline-flex items-center gap-2 text-mint hover:text-text-primary transition-colors"
        >
          View Implementation Guide &#8594;
        </a>
      </div>
      <Panel size="md" class="space-y-phi-2 text-sm text-text-secondary">
        <div class="flex items-start gap-phi-2">
          <span class="text-mint">&#x2022;</span>
          <span>Kernel invariants and data paths</span>
        </div>
        <div class="flex items-start gap-phi-2">
          <span class="text-mint">&#x2022;</span>
          <span>Bundled module boundaries + best practices</span>
        </div>
        <div class="flex items-start gap-phi-2">
          <span class="text-mint">&#x2022;</span>
          <span>Status semantics: current vs building vs future</span>
        </div>
        <div class="flex items-start gap-phi-2">
          <span class="text-mint">&#x2022;</span>
          <span>Roadmap IDs tied to implementation detail</span>
        </div>
      </Panel>
    </Panel>
  </Section>

  <Section tone="light" class="border-t border-line/10">
    <SectionHeader
      eyebrow="Choose Your Path"
      subtitle="Each path includes a proof link so you can verify what matters before you commit time."
      class="mb-phi-5"
    >
      <span slot="title">Designed for the journey you are on</span>
    </SectionHeader>
    <div class="grid md:grid-cols-2 gap-phi-3">
      {personaMap.personas.map((persona) => {
        const proof = proofIndex.get(persona.proof_id);
        const path = persona.next.startsWith('/') ? persona.next.slice(1) : persona.next;
        return (
          <PersonaCard
            title={persona.title}
            hook={persona.hook}
            value={persona.value}
            href={`${base}${path}`}
            proofLabel={proof ? proof.evidence[0].label : null}
            proofUrl={proof ? proof.evidence[0].url : null}
          />
        );
      })}
    </div>
  </Section>

  <Section tone="light">
    <SectionHeader
      subtitle="Each module eliminates a specific category of rework: reading, coordination, trust, and reasoning."
      class="mb-phi-5"
      size="xl"
      titleClassName="display-contrast"
    >
      <span slot="title">Four Modules. <strong>Four Types of Waste Eliminated.</strong></span>
    </SectionHeader>
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-phi-3">
      {moduleHighlights.map((module) => (
        <ModuleCard
          name={module.name}
          focus={module.focus}
          summaryLead={module.summary.lead}
          summaryRest={module.summary.rest}
          bullets={module.bullets}
          href={module.href}
          cta={module.cta}
        />
      ))}
    </div>
  </Section>

  <Section tone="light" class="text-center border-t border-line/10" innerClass="max-w-4xl">
    <h2 class="text-3xl md:text-4xl font-display text-text-primary mb-phi-3">Open Source. Verifiable. Yours.</h2>
    <p class="text-lg text-text-secondary mb-phi-4 leading-relaxed">
      Boyd gave away OODA because paradigms should be shared.<br class="hidden md:inline" />
      We honor that by keeping the Work Compiler open source.<br class="hidden md:inline" />
      The infrastructure has a cost. The idea doesn&apos;t.
    </p>

    <div class="flex flex-col md:flex-row gap-phi-3 justify-center items-center text-left md:text-center">
      <div class="flex items-center gap-phi-1">
        <span class="text-mint text-xl">&#10003;</span>
        <span class="text-text-primary">Your receipts are YOUR data</span>
      </div>
      <div class="flex items-center gap-phi-1">
        <span class="text-mint text-xl">&#10003;</span>
        <span class="text-text-primary">Local by default</span>
      </div>
      <div class="flex items-center gap-phi-1">
        <span class="text-mint text-xl">&#10003;</span>
        <span class="text-text-primary">Audit every line of code</span>
      </div>
    </div>

    <div class="mt-phi-4">
      <a href="https://github.com/motus-os/motus" target="_blank" rel="noopener" class="inline-flex items-center gap-2 text-mint hover:text-text-primary transition-colors">
        <GitHubIcon />
        View on GitHub
      </a>
    </div>
  </Section>

  <Section tone="light" class="text-center" innerClass="max-w-2xl">
    <h2 class="text-2xl md:text-3xl font-display text-text-primary mb-phi-3">
      Ready to make your agents capable?
    </h2>
    <InstallCommand />
  </Section>
</Layout>
