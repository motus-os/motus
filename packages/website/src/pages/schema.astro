---
import Layout from '../layouts/Layout.astro';
import Section from '../components/Section.astro';
import Panel from '../components/Panel.astro';
import SectionHeader from '../components/SectionHeader.astro';
---

<Layout title="Kernel Schema v0.1.3">
  <Section tone="dark" class="text-center" innerClass="max-w-3xl">
    <SectionHeader
      title="Kernel Schema v0.1.3"
      subtitle="The minimal, audited core that powers Motus."
      as="h1"
      size="xl"
    />
  </Section>

  <Section tone="light" pad="tight" class="border-t border-line/10" innerClass="max-w-4xl">
    <Panel size="sm">
      <p class="text-text-secondary mb-2">Status: APPROVED</p>
      <p class="text-text-secondary mb-2">Owner: DOCS_SPECS</p>
      <p class="text-text-secondary mb-2">Scope: Kernel schema + coordination.db</p>
      <p class="text-text-secondary mb-2">Version: 0.1.3</p>
      <p class="text-text-secondary">Date: 2025-12-29</p>
    </Panel>
  </Section>

  <Section tone="muted" pad="tight" innerClass="max-w-5xl">
    <SectionHeader title="Single Source of Truth" class="mb-phi-4" maxWidth="max-w-3xl">
      <span slot="subtitle">
        Kernel state lives in <span class="text-text-primary font-medium">~/.motus/coordination.db</span>.
        This file is the authoritative record for attempts, decisions, evidence, and leases.
      </span>
    </SectionHeader>
    <Panel size="sm">
      <code class="text-mint font-mono text-sm">~/.motus/coordination.db</code>
      <p class="text-text-secondary mt-2 text-sm">
        Kernel truth. Append-only governance. Deterministic replay.
      </p>
    </Panel>
  </Section>

  <Section tone="light" pad="tight" innerClass="max-w-5xl">
    <SectionHeader
      title="6-Call Coordination API"
      subtitle="These calls are the public surface for coordination and outcomes."
      class="mb-phi-4"
      maxWidth="max-w-2xl"
    />
    <div class="grid md:grid-cols-2 gap-phi-3">
      <Panel size="sm">
        <code class="text-mint font-mono text-lg">claim_work()</code>
        <p class="text-text-secondary mt-2">Claim a task, acquire a lease, and receive context.</p>
      </Panel>
      <Panel size="sm">
        <code class="text-mint font-mono text-lg">get_context()</code>
        <p class="text-text-secondary mt-2">Refresh the Lens mid-task with current prerequisites.</p>
      </Panel>
      <Panel size="sm">
        <code class="text-mint font-mono text-lg">put_outcome()</code>
        <p class="text-text-secondary mt-2">Record the outcome of an attempt.</p>
      </Panel>
      <Panel size="sm">
        <code class="text-mint font-mono text-lg">record_evidence()</code>
        <p class="text-text-secondary mt-2">Attach proof artifacts tied to outcomes.</p>
      </Panel>
      <Panel size="sm">
        <code class="text-mint font-mono text-lg">record_decision()</code>
        <p class="text-text-secondary mt-2">Append governance decisions and waivers.</p>
      </Panel>
      <Panel size="sm">
        <code class="text-mint font-mono text-lg">release_work()</code>
        <p class="text-text-secondary mt-2">Finalize, attach proof, and release the lease.</p>
      </Panel>
    </div>
  </Section>

  <Section tone="muted" pad="tight" innerClass="max-w-5xl">
    <SectionHeader
      title="Core Tables (v0.1.3)"
      subtitle="The kernel is intentionally small. Outcomes live on attempts and are proven by evidence."
      class="mb-phi-4"
      maxWidth="max-w-2xl"
    />
    <div class="grid md:grid-cols-2 gap-phi-3">
      <Panel size="sm">
        <p class="text-text-primary font-medium">roadmap_items</p>
        <p class="text-text-secondary text-sm">Planning intent and dependency graph.</p>
      </Panel>
      <Panel size="sm">
        <p class="text-text-primary font-medium">attempts</p>
        <p class="text-text-secondary text-sm">Execution instances + outcome status.</p>
      </Panel>
      <Panel size="sm">
        <p class="text-text-primary font-medium">decisions</p>
        <p class="text-text-secondary text-sm">Append-only approvals, waivers, reviews.</p>
      </Panel>
      <Panel size="sm">
        <p class="text-text-primary font-medium">evidence</p>
        <p class="text-text-secondary text-sm">Typed, hashed proof artifacts.</p>
      </Panel>
      <Panel size="sm">
        <p class="text-text-primary font-medium">blockers</p>
        <p class="text-text-secondary text-sm">Execution issues with resolution tracking.</p>
      </Panel>
      <Panel size="sm">
        <p class="text-text-primary font-medium">leases</p>
        <p class="text-text-secondary text-sm">Resource coordination and exclusivity.</p>
      </Panel>
    </div>
  </Section>

  <Section tone="light" class="text-center" innerClass="max-w-4xl">
    <SectionHeader
      title="Full Schema Reference"
      subtitle="The complete DDL lives in the repository as KERNEL-SCHEMA v0.1.3."
      size="md"
      class="mb-8"
    />
    <a
      href="https://github.com/motus-os/motus/blob/main/packages/cli/docs/schema/kernel.md"
      target="_blank"
      rel="noopener"
      class="inline-flex items-center gap-2 bg-mint text-charcoal font-semibold px-6 py-3 rounded-lg hover:bg-white transition-colors"
    >
      View Kernel Schema
    </a>
  </Section>
</Layout>
